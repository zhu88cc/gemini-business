{% extends "base.html" %}
{% from "components/alerts.html" import api_key_status, error_alert, no_accounts_alert %}
{% from "components/account_table.html" import account_table %}

{% block title %}ç³»ç»Ÿç®¡ç† - Gemini Business API{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/admin.css?v={{ static_version }}">
{% endblock %}

{% block content %}
<div class="container">
            <div class="header">
                <div class="header-info">
                    <h1>Gemini-Business2api</h1>
                    <div class="subtitle">å¤šè´¦æˆ·ä»£ç†é¢æ¿</div>
                </div>
                <div class="header-actions">
                    <a href="/public/uptime/html" class="btn" target="_blank">ğŸ“Š çŠ¶æ€ç›‘æ§</a>
                    <a href="/public/log/html" class="btn" target="_blank">ğŸ“„ å…¬å¼€æ—¥å¿—</a>
                    <a href="/{{ admin_path_segment }}/log/html" class="btn" target="_blank">ğŸ”§ ç®¡ç†æ—¥å¿—</a>
                    <button class="btn" onclick="document.getElementById('fileInput').click()">ğŸ“¥ æ‰¹é‡ä¸Šä¼ </button>
                    <input type="file" id="fileInput" accept=".json" multiple style="display:none" onchange="handleFileUpload(event)">
                    <button class="btn" onclick="showEditConfig()" id="edit-btn">âœï¸ ç¼–è¾‘é…ç½®</button>
                </div>
            </div>

            <!-- Tabs Navigation -->
            <div class="tabs-nav">
                <button class="tab-button active" onclick="switchTab('accounts')">ğŸ“‹ è´¦æˆ·ç®¡ç†</button>
                <button class="tab-button" onclick="switchTab('api')">ğŸ“š APIæ–‡æ¡£</button>
                <button class="tab-button" onclick="switchTab('config')">âš™ï¸ ç³»ç»Ÿé…ç½®</button>
                <button class="tab-button" onclick="switchTab('settings')">ğŸ”§ ç³»ç»Ÿè®¾ç½®</button>
            </div>

            <!-- Tab 1: è´¦æˆ·ç®¡ç† -->
            <div id="tab-accounts" class="tab-content active">
                {{ api_key_status(has_api_key) }}
                {{ error_alert(error_count, admin_path_segment) }}
                {% if multi_account_mgr.accounts|length == 0 %}
                    {{ no_accounts_alert() }}
                {% endif %}

                <div class="alert alert-primary">
                    <div class="alert-icon">ğŸ”—</div>
                    <div class="alert-content">
                        <strong>API æ¥å£</strong>
                        <div style="margin-top: 6px; color: #86868b; font-size: 11px;">æ ¹æ®å®¢æˆ·ç«¯é€‰æ‹©å¯¹åº”æ¥å£</div>
                        <div style="margin-top: 10px; display: grid; gap: 10px;">
                            <div class="api-item">
                                <span class="api-item-label">åŸºç¡€ç«¯ç‚¹</span>
                                <div class="api-item-content" style="display: flex; gap: 8px; flex: 1;">
                                    <code class="api-item-code">{{ api_base_url }}</code>
                                    <button class="btn-copy" onclick="navigator.clipboard.writeText('{{ api_base_url }}').then(() => { this.innerHTML = 'âœ…'; setTimeout(() => this.innerHTML = 'ğŸ“‹', 2000); })">ğŸ“‹</button>
                                </div>
                            </div>
                            <div class="api-item">
                                <span class="api-item-label">SDK æ¥å£</span>
                                <div class="api-item-content" style="display: flex; gap: 8px; flex: 1;">
                                    <code class="api-item-code">{{ api_base_v1 }}</code>
                                    <button class="btn-copy" onclick="navigator.clipboard.writeText('{{ api_base_v1 }}').then(() => { this.innerHTML = 'âœ…'; setTimeout(() => this.innerHTML = 'ğŸ“‹', 2000); })">ğŸ“‹</button>
                                </div>
                            </div>
                            <div class="api-item">
                                <span class="api-item-label">å®Œæ•´æ¥å£</span>
                                <div class="api-item-content" style="display: flex; gap: 8px; flex: 1;">
                                    <code class="api-item-code">{{ api_endpoint }}</code>
                                    <button class="btn-copy" onclick="navigator.clipboard.writeText('{{ api_endpoint }}').then(() => { this.innerHTML = 'âœ…'; setTimeout(() => this.innerHTML = 'ğŸ“‹', 2000); })">ğŸ“‹</button>
                                </div>
                            </div>
                            <div class="api-item">
                                <span class="api-item-label">API å¯†é’¥</span>
                                <div class="api-item-content" style="display: flex; gap: 8px; flex: 1;">
                                    <code class="api-item-code">{% if main.API_KEY %}{{ main.API_KEY }}{% else %}<span style="color: #ff9500;">æœªè®¾ç½®</span>{% endif %}</code>
                                    {% if main.API_KEY %}
                                    <button class="btn-copy" onclick="navigator.clipboard.writeText('{{ main.API_KEY }}').then(() => { this.innerHTML = 'âœ…'; setTimeout(() => this.innerHTML = 'ğŸ“‹', 2000); })">ğŸ“‹</button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(0,0,0,0.06);">
                            <div style="font-size: 11px; color: #6b6b6b; margin-bottom: 6px;">æ”¯æŒçš„æ¨¡å‹</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 6px;">
                                <span style="background: #f0f0f2; color: #1d1d1f; padding: 3px 8px; border-radius: 4px; font-size: 11px; font-family: 'SF Mono', SFMono-Regular, Consolas, monospace;">gemini-auto</span>
                                <span style="background: #f0f0f2; color: #1d1d1f; padding: 3px 8px; border-radius: 4px; font-size: 11px; font-family: 'SF Mono', SFMono-Regular, Consolas, monospace;">gemini-2.5-flash</span>
                                <span style="background: #f0f0f2; color: #1d1d1f; padding: 3px 8px; border-radius: 4px; font-size: 11px; font-family: 'SF Mono', SFMono-Regular, Consolas, monospace;">gemini-2.5-pro</span>
                                <span style="background: #f0f0f2; color: #1d1d1f; padding: 3px 8px; border-radius: 4px; font-size: 11px; font-family: 'SF Mono', SFMono-Regular, Consolas, monospace;">gemini-3-flash-preview</span>
                                <span style="background: #f0f0f2; color: #1d1d1f; padding: 3px 8px; border-radius: 4px; font-size: 11px; font-family: 'SF Mono', SFMono-Regular, Consolas, monospace;">gemini-3-pro-preview</span>
                            </div>
                            <div style="margin-top: 8px; font-size: 11px; color: #86868b;">
                                ğŸ“¸ å›¾ç‰‡ç”Ÿæˆå¯åœ¨"ç³»ç»Ÿè®¾ç½®"è‡ªå®šä¹‰é…ç½®
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">è´¦æˆ·çŠ¶æ€ ({{ multi_account_mgr.accounts|length }} ä¸ª)</div>
                    <div style="color: #6b6b6b; font-size: 12px; margin-bottom: 12px; padding-left: 4px;">
                        é»˜è®¤è¿‡æœŸæ—¶é—´12å°æ—¶ï¼Œæ³¨æ„åŒ—äº¬æ—¶é—´ â€¢ æ‰¹é‡ä¸Šä¼ ä½¿ç”¨ <code style="font-size: 11px; background: rgba(0,0,0,0.05); padding: 2px 6px; border-radius: 4px;">script/download-config.js</code> æ²¹çŒ´è„šæœ¬
                    </div>

                    <!-- æ‰¹é‡æ³¨å†ŒæŒ‰é’®å’Œè¿›åº¦å±•ç¤º -->
                    <div style="margin-bottom: 16px; padding: 12px; background: #f5f5f7; border-radius: 8px;">
                        <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
                            <button class="btn" onclick="showRegisterModal()" style="background: #0071e3; color: white;">
                                ğŸš€ æ‰¹é‡æ³¨å†Œè´¦æˆ·
                            </button>
                            <div id="register-progress" style="display: none; flex: 1; min-width: 300px;">
                                <div style="display: flex; gap: 16px; align-items: center;">
                                    <div style="flex: 1;">
                                        <div style="font-size: 11px; color: #6b6b6b; margin-bottom: 4px;">
                                            è¿›åº¦: <span id="reg-current">0</span>/<span id="reg-total">0</span>
                                        </div>
                                        <div style="background: #e5e5ea; border-radius: 4px; height: 6px; overflow: hidden;">
                                            <div id="reg-progress-bar" style="background: #0071e3; height: 100%; width: 0%; transition: width 0.3s;"></div>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 12px; font-size: 12px;">
                                        <span style="color: #34c759;">âœ… æˆåŠŸ: <strong id="reg-success">0</strong></span>
                                        <span style="color: #ff3b30;">âŒ å¤±è´¥: <strong id="reg-fail">0</strong></span>
                                        <span style="color: #0071e3;">ğŸ“Š æˆåŠŸç‡: <strong id="reg-rate">0%</strong></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {{ account_table(accounts_data) }}
                </div>
            </div>

            <!-- Tab 2: APIæ–‡æ¡£ -->
            <div id="tab-api" class="tab-content">
                <div class="section">
                    <div class="section-title">API ç«¯ç‚¹åˆ—è¡¨</div>

                    <div class="current-url-row">
                        <span style="font-size:12px; font-weight:600; color:#0071e3; margin-right:8px;">å½“å‰é¡µé¢:</span>
                        <code style="background:none; padding:0; color:#1d1d1f;">{{ current_url }}</code>
                    </div>

                    <table class="ep-table">
                        <tr>
                            <td width="70"><span class="method m-post">POST</span></td>
                            <td><span class="ep-path">/{{ api_path_segment }}v1/chat/completions</span></td>
                            <td><span class="ep-desc">OpenAI å…¼å®¹å¯¹è¯æ¥å£</span></td>
                        </tr>
                        <tr>
                            <td><span class="method m-get">GET</span></td>
                            <td><span class="ep-path">/{{ api_path_segment }}v1/models</span></td>
                            <td><span class="ep-desc">è·å–æ¨¡å‹åˆ—è¡¨</span></td>
                        </tr>
                        <tr>
                            <td><span class="method m-get">GET</span></td>
                            <td><span class="ep-path">/{{ admin_path_segment }}</span></td>
                            <td><span class="ep-desc">ç®¡ç†é¦–é¡µ (éœ€ç™»å½•)</span></td>
                        </tr>
                        <tr>
                            <td><span class="method m-get">GET</span></td>
                            <td><span class="ep-path">/{{ admin_path_segment }}/health</span></td>
                            <td><span class="ep-desc">å¥åº·æ£€æŸ¥ (éœ€ç™»å½•)</span></td>
                        </tr>
                        <tr>
                            <td><span class="method m-get">GET</span></td>
                            <td><span class="ep-path">/{{ admin_path_segment }}/accounts</span></td>
                            <td><span class="ep-desc">è´¦æˆ·çŠ¶æ€ JSON (éœ€ç™»å½•)</span></td>
                        </tr>
                        <tr>
                            <td><span class="method m-get">GET</span></td>
                            <td><span class="ep-path">/{{ admin_path_segment }}/log</span></td>
                            <td><span class="ep-desc">è·å–æ—¥å¿— JSON (éœ€ç™»å½•)</span></td>
                        </tr>
                        <tr>
                            <td><span class="method m-get">GET</span></td>
                            <td><span class="ep-path">/{{ admin_path_segment }}/log/html</span></td>
                            <td><span class="ep-desc">æ—¥å¿—æŸ¥çœ‹å™¨ HTML (éœ€ç™»å½•)</span></td>
                        </tr>
                        <tr>
                            <td><span class="method m-del">DEL</span></td>
                            <td><span class="ep-path">/{{ admin_path_segment }}/log?confirm=yes</span></td>
                            <td><span class="ep-desc">æ¸…ç©ºç³»ç»Ÿæ—¥å¿— (éœ€ç™»å½•)</span></td>
                        </tr>
                        <tr>
                            <td><span class="method m-get">GET</span></td>
                            <td><span class="ep-path">/public/stats</span></td>
                            <td><span class="ep-desc">å…¬å¼€ç»Ÿè®¡æ•°æ®</span></td>
                        </tr>
                        <tr>
                            <td><span class="method m-get">GET</span></td>
                            <td><span class="ep-path">/public/log</span></td>
                            <td><span class="ep-desc">å…¬å¼€æ—¥å¿— (JSON, è„±æ•)</span></td>
                        </tr>
                        <tr>
                            <td><span class="method m-get">GET</span></td>
                            <td><span class="ep-path">/public/log/html</span></td>
                            <td><span class="ep-desc">å…¬å¼€æ—¥å¿—æŸ¥çœ‹å™¨ (HTML)</span></td>
                        </tr>
                        <tr>
                            <td><span class="method m-get">GET</span></td>
                            <td><span class="ep-path">/public/uptime</span></td>
                            <td><span class="ep-desc">å®æ—¶çŠ¶æ€ç›‘æ§ (JSON)</span></td>
                        </tr>
                        <tr>
                            <td><span class="method m-get">GET</span></td>
                            <td><span class="ep-path">/public/uptime/html</span></td>
                            <td><span class="ep-desc">å®æ—¶çŠ¶æ€ç›‘æ§é¡µé¢ (HTML)</span></td>
                        </tr>
                        <tr>
                            <td><span class="method m-get">GET</span></td>
                            <td><span class="ep-path">/docs</span></td>
                            <td><span class="ep-desc">Swagger API æ–‡æ¡£</span></td>
                        </tr>
                        <tr>
                            <td><span class="method m-get">GET</span></td>
                            <td><span class="ep-path">/redoc</span></td>
                            <td><span class="ep-desc">ReDoc API æ–‡æ¡£</span></td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- Tab 3: ç³»ç»Ÿé…ç½® -->
            <div id="tab-config" class="tab-content">
                <div class="section">
                    <div class="section-title">å½“å‰é…ç½®çŠ¶æ€</div>
                    <div class="grid-env">
                        <div class="stack-col">
                            <div class="card">
                                <h3>ç¯å¢ƒå˜é‡ <span class="badge badge-required">ENV</span></h3>
                            <div style="margin-top: 12px;">
                                <div class="env-var">
                                    <div><div class="env-name">ADMIN_KEY</div><div class="env-desc">ç®¡ç†å‘˜å¯†é’¥</div></div>
                                    <div class="env-value">å·²è®¾ç½®</div>
                                </div>
                                <div class="env-var">
                                    <div><div class="env-name">PATH_PREFIX</div><div class="env-desc">APIè·¯å¾„å‰ç¼€</div></div>
                                    <div class="env-value">{{ main.PATH_PREFIX or 'æœªè®¾ç½®' }}</div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <h3>åŸºç¡€é…ç½® <span class="badge badge-optional">YAML</span></h3>
                            <div style="margin-top: 12px;">
                                <div class="env-var">
                                    <div><div class="env-name">API_KEY</div><div class="env-desc">APIè®¿é—®å¯†é’¥</div></div>
                                    <div class="env-value">{% if main.API_KEY %}å·²è®¾ç½®{% else %}æœªè®¾ç½®ï¼ˆå…¬å¼€è®¿é—®ï¼‰{% endif %}</div>
                                </div>
                                <div class="env-var">
                                    <div><div class="env-name">BASE_URL</div><div class="env-desc">æœåŠ¡å™¨URL</div></div>
                                    <div class="env-value">{% if main.BASE_URL %}å·²è®¾ç½®{% else %}è‡ªåŠ¨æ£€æµ‹{% endif %}</div>
                                </div>
                                <div class="env-var">
                                    <div><div class="env-name">PROXY</div><div class="env-desc">ä»£ç†åœ°å€</div></div>
                                    <div class="env-value">{% if main.PROXY %}å·²è®¾ç½®{% else %}æœªè®¾ç½®{% endif %}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                        <div class="card">
                            <h3>é‡è¯•ç­–ç•¥ <span class="badge badge-optional">YAML</span></h3>
                            <div style="margin-top: 12px;">
                                <div class="env-var">
                                    <div><div class="env-name">max_new_session_tries</div><div class="env-desc">æ–°ä¼šè¯å°è¯•æ•°</div></div>
                                    <div class="env-value">{{ main.MAX_NEW_SESSION_TRIES }}</div>
                                </div>
                                <div class="env-var">
                                    <div><div class="env-name">max_request_retries</div><div class="env-desc">è¯·æ±‚é‡è¯•æ¬¡æ•°</div></div>
                                    <div class="env-value">{{ main.MAX_REQUEST_RETRIES }}</div>
                                </div>
                                <div class="env-var">
                                    <div><div class="env-name">max_account_switch_tries</div><div class="env-desc">è´¦æˆ·åˆ‡æ¢æ¬¡æ•°</div></div>
                                    <div class="env-value">{{ main.MAX_ACCOUNT_SWITCH_TRIES }}</div>
                                </div>
                                <div class="env-var">
                                    <div><div class="env-name">account_failure_threshold</div><div class="env-desc">å¤±è´¥é˜ˆå€¼</div></div>
                                    <div class="env-value">{{ main.ACCOUNT_FAILURE_THRESHOLD }} æ¬¡</div>
                                </div>
                                <div class="env-var">
                                    <div><div class="env-name">rate_limit_cooldown_seconds</div><div class="env-desc">429å†·å´æ—¶é—´</div></div>
                                    <div class="env-value">{{ main.RATE_LIMIT_COOLDOWN_SECONDS }} ç§’</div>
                                </div>
                                <div class="env-var">
                                    <div><div class="env-name">session_cache_ttl_seconds</div><div class="env-desc">ä¼šè¯ç¼“å­˜æ—¶é—´</div></div>
                                    <div class="env-value">{{ main.SESSION_CACHE_TTL_SECONDS }} ç§’</div>
                                </div>
                            </div>
                        </div>

                    <div class="card">
                        <h3>å…¬å¼€å±•ç¤º <span class="badge badge-optional">YAML</span></h3>
                        <div style="margin-top: 12px;">
                            <div class="env-var">
                                <div><div class="env-name">LOGO_URL</div><div class="env-desc">Logoå›¾ç‰‡</div></div>
                                <div class="env-value">{% if main.LOGO_URL %}å·²è®¾ç½®{% else %}æœªè®¾ç½®{% endif %}</div>
                            </div>
                            <div class="env-var">
                                <div><div class="env-name">CHAT_URL</div><div class="env-desc">å¯¹è¯é“¾æ¥</div></div>
                                <div class="env-value">{% if main.CHAT_URL %}å·²è®¾ç½®{% else %}æœªè®¾ç½®{% endif %}</div>
                            </div>
                        </div>
                    </div>
                        </div>
                </div>
            </div>

            <!-- Tab 4: ç³»ç»Ÿè®¾ç½® -->
            <div id="tab-settings" class="tab-content">
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; gap: 16px; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 200px;">
                            <div class="section-title" style="margin-bottom: 4px;">ç³»ç»Ÿè®¾ç½®</div>
                            <div style="color: #6b6b6b; font-size: 11px; padding-left: 4px;">
                                âœ… é…ç½®ä¿®æ”¹åç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯ â€¢ ğŸ“‹ ä¼˜å…ˆçº§ï¼šYAML > ç¯å¢ƒå˜é‡ > é»˜è®¤å€¼
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; flex-shrink: 0;">
                            <button class="btn" onclick="loadSettings()">é‡ç½®</button>
                            <button class="btn" onclick="saveSettings()">ä¿å­˜è®¾ç½®</button>
                        </div>
                    </div>

                    <div class="grid-env">
                        <div class="stack-col">
                            <!-- åŸºç¡€é…ç½® -->
                            <div class="card">
                                <h3>åŸºç¡€é…ç½®</h3>
                                <div style="margin-top: 12px;">
                                    <div class="setting-item">
                                        <label>API è®¿é—®å¯†é’¥</label>
                                        <input type="text" id="setting-api-key" placeholder="ç•™ç©ºåˆ™å…¬å¼€è®¿é—®" />
                                    </div>
                                    <div class="setting-item">
                                        <label>æœåŠ¡å™¨ URL</label>
                                        <input type="text" id="setting-base-url" placeholder="ç•™ç©ºåˆ™è‡ªåŠ¨æ£€æµ‹" />
                                    </div>
                                    <div class="setting-item">
                                        <label>ä»£ç†åœ°å€</label>
                                        <input type="text" id="setting-proxy" placeholder="å¦‚ http://127.0.0.1:7890" />
                                    </div>
                                </div>
                            </div>

                            <!-- ä¸´æ—¶é‚®ç®±é…ç½® -->
                            <div class="card">
                                <h3>ğŸ“§ ä¸´æ—¶é‚®ç®±é…ç½®</h3>
                                <div style="margin-top: 12px;">
                                    <div class="setting-item">
                                        <label>é‚®ç®± API åœ°å€</label>
                                        <input type="text" id="setting-mail-api" placeholder="ä¸´æ—¶é‚®ç®± API åœ°å€" />
                                    </div>
                                    <div class="setting-item">
                                        <label>é‚®ç®±ç®¡ç†å‘˜å¯†é’¥</label>
                                        <input type="text" id="setting-mail-admin-key" placeholder="ä¸´æ—¶é‚®ç®±ç®¡ç†å‘˜å¯†é’¥" />
                                    </div>
                                    <div class="setting-item">
                                        <label>è°·æ­Œå‘ä»¶é‚®ç®±</label>
                                        <input type="text" id="setting-google-mail" placeholder="å¦‚ noreply-googlecloud@google.com" />
                                    </div>
                                    <div class="setting-item">
                                        <label>é‚®ç®±åŸŸååˆ—è¡¨ï¼ˆé€—å·åˆ†éš”ï¼‰</label>
                                        <input type="text" id="setting-email-domain" placeholder="å¦‚ domain1.com,domain2.org,domain3.net" />
                                        <div style="margin-top: 4px; font-size: 11px; color: #6b6b6b;">
                                            æ”¯æŒå¤šä¸ªåŸŸåï¼Œç”¨è‹±æ–‡é€—å·åˆ†éš”ï¼Œæ³¨å†Œæ—¶ä¼šéšæœºé€‰æ‹©
                                        </div>
                                    </div>
                                    <div class="setting-item">
                                        <label>é»˜è®¤æ³¨å†Œæ•°é‡</label>
                                        <input type="number" id="setting-register-number" min="1" max="100" placeholder="5" />
                                    </div>
                                </div>
                            </div>

                            <!-- è‡ªåŠ¨æ³¨å†Œé…ç½® -->
                            <div class="card">
                                <h3>ğŸ•’ è‡ªåŠ¨æ³¨å†Œé…ç½®</h3>
                                <div style="margin-top: 12px;">
                                    <div class="setting-item">
                                        <label style="display: flex; align-items: center; gap: 8px;">
                                            <input type="checkbox" id="setting-auto-register-enabled" style="width: auto;" />
                                            å¯ç”¨è‡ªåŠ¨æ³¨å†Œ
                                        </label>
                                    </div>
                                    <div class="setting-item">
                                        <label>Cron è¡¨è¾¾å¼ï¼ˆ5æ®µï¼‰</label>
                                        <input type="text" id="setting-auto-register-cron" placeholder="å¦‚ 0 3 * * *" />
                                        <div style="margin-top: 4px; font-size: 11px; color: #6b6b6b;">
                                            åˆ†é’Ÿ å°æ—¶ æ—¥ æœˆ å‘¨ï¼ˆ0=å‘¨æ—¥ï¼Œ1=å‘¨ä¸€ï¼‰
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- å›¾ç‰‡ç”Ÿæˆé…ç½® -->
                            <div class="card">
                                <h3>ğŸ“¸ å›¾ç‰‡ç”Ÿæˆé…ç½®</h3>
                                <div style="margin-top: 12px;">
                                    <div class="setting-item">
                                        <label style="display: flex; align-items: center; gap: 8px;">
                                            <input type="checkbox" id="setting-image-enabled" style="width: auto;" />
                                            å¯ç”¨å›¾ç‰‡ç”Ÿæˆ
                                        </label>
                                    </div>
                                    <div class="setting-item">
                                        <label>æ”¯æŒçš„æ¨¡å‹</label>
                                        <div id="setting-image-models" style="display: flex; flex-direction: column; gap: 6px; margin-top: 6px;">
                                            <label style="display: flex; align-items: center; gap: 6px; font-weight: normal; font-size: 12px;">
                                                <input type="checkbox" value="gemini-3-pro-preview" style="width: auto;" /> gemini-3-pro-preview
                                            </label>
                                            <label style="display: flex; align-items: center; gap: 6px; font-weight: normal; font-size: 12px;">
                                                <input type="checkbox" value="gemini-2.5-pro" style="width: auto;" /> gemini-2.5-pro
                                            </label>
                                            <label style="display: flex; align-items: center; gap: 6px; font-weight: normal; font-size: 12px;">
                                                <input type="checkbox" value="gemini-2.5-flash" style="width: auto;" /> gemini-2.5-flash
                                            </label>
                                            <label style="display: flex; align-items: center; gap: 6px; font-weight: normal; font-size: 12px;">
                                                <input type="checkbox" value="gemini-3-flash-preview" style="width: auto;" /> gemini-3-flash-preview
                                            </label>
                                            <label style="display: flex; align-items: center; gap: 6px; font-weight: normal; font-size: 12px;">
                                                <input type="checkbox" value="gemini-auto" style="width: auto;" /> gemini-auto
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="stack-col">
                            <!-- é‡è¯•ç­–ç•¥é…ç½® -->
                            <div class="card">
                                <h3>ğŸ”„ é‡è¯•ç­–ç•¥é…ç½®</h3>
                                <div style="margin-top: 12px;">
                                    <div class="setting-item">
                                        <label>æ–°ä¼šè¯å°è¯•è´¦æˆ·æ•°</label>
                                        <input type="number" id="setting-max-new-session" min="1" max="20" />
                                    </div>
                                    <div class="setting-item">
                                        <label>è¯·æ±‚å¤±è´¥é‡è¯•æ¬¡æ•°</label>
                                        <input type="number" id="setting-max-retries" min="1" max="10" />
                                    </div>
                                    <div class="setting-item">
                                        <label>è´¦æˆ·åˆ‡æ¢å°è¯•æ¬¡æ•°</label>
                                        <input type="number" id="setting-max-switch" min="1" max="20" />
                                    </div>
                                    <div class="setting-item">
                                        <label>è´¦æˆ·å¤±è´¥é˜ˆå€¼ï¼ˆæ¬¡ï¼‰</label>
                                        <input type="number" id="setting-failure-threshold" min="1" max="10" />
                                    </div>
                                    <div class="setting-item">
                                        <label>429 å†·å´æ—¶é—´ï¼ˆç§’ï¼‰</label>
                                        <input type="number" id="setting-cooldown" min="60" max="3600" />
                                    </div>
                                    <div class="setting-item">
                                        <label>ä¼šè¯ç¼“å­˜æ—¶é—´ï¼ˆç§’ï¼‰</label>
                                        <input type="number" id="setting-cache-ttl" min="300" max="86400" />
                                    </div>
                                </div>
                            </div>

                            <!-- å…¬å¼€å±•ç¤ºé…ç½® -->
                            <div class="card">
                                <h3>ğŸ¨ å…¬å¼€å±•ç¤ºé…ç½®</h3>
                                <div style="margin-top: 12px;">
                                    <div class="setting-item">
                                        <label>Logo URL</label>
                                        <input type="text" id="setting-logo-url" placeholder="ç•™ç©ºåˆ™ä¸æ˜¾ç¤º" />
                                    </div>
                                    <div class="setting-item">
                                        <label>å¼€å§‹å¯¹è¯é“¾æ¥</label>
                                        <input type="text" id="setting-chat-url" placeholder="ç•™ç©ºåˆ™ä¸æ˜¾ç¤º" />
                                    </div>
                                    <div class="setting-item">
                                        <label>Session è¿‡æœŸæ—¶é—´ï¼ˆå°æ—¶ï¼‰</label>
                                        <input type="number" id="setting-session-hours" min="1" max="168" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- JSON ç¼–è¾‘å™¨æ¨¡æ€æ¡† -->
        <div id="jsonModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">ç¼–è¾‘è´¦æˆ·é…ç½®</div>
                    <button class="modal-close" onclick="closeModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <textarea id="jsonEditor" class="json-editor" placeholder="åœ¨æ­¤ç¼–è¾‘ JSON é…ç½®..."></textarea>
                    <div id="jsonError" class="json-error"></div>
                    <div style="margin-top: 12px; font-size: 12px; color: #6b6b6b;">
                        <strong>æç¤ºï¼š</strong>ç¼–è¾‘å®Œæˆåç‚¹å‡»"ä¿å­˜"æŒ‰é’®ã€‚JSON æ ¼å¼é”™è¯¯æ—¶æ— æ³•ä¿å­˜ã€‚<br>
                        é…ç½®ç«‹å³ç”Ÿæ•ˆã€‚é‡å¯åå°†ä»ç¯å¢ƒå˜é‡é‡æ–°åŠ è½½ï¼Œå»ºè®®åŒæ­¥æ›´æ–° ACCOUNTS_CONFIGã€‚
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
                    <button class="btn btn-primary" onclick="saveConfig()">ä¿å­˜é…ç½®</button>
                </div>
            </div>
        </div>

        <!-- æ‰¹é‡æ³¨å†Œæ¨¡æ€æ¡† -->
        <div id="registerModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">ğŸš€ æ‰¹é‡æ³¨å†Œè´¦æˆ·</div>
                    <button class="modal-close" onclick="closeRegisterModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="setting-item">
                        <label>æ³¨å†Œæ•°é‡</label>
                        <input type="number" id="register-count" min="1" max="50" value="5" />
                        <div style="margin-top: 4px; font-size: 11px; color: #6b6b6b;">
                            ä¸€æ¬¡æœ€å¤šæ³¨å†Œ 50 ä¸ªè´¦æˆ·
                        </div>
                    </div>
                    <div class="setting-item">
                        <label>é‚®ç®±åŸŸå</label>
                        <select id="register-domain" style="width: 100%; padding: 8px; border: 1px solid #d2d2d7; border-radius: 6px; font-size: 13px;">
                            <option value="">éšæœºé€‰æ‹©åŸŸå</option>
                            <!-- åŠ¨æ€å¡«å……åŸŸååˆ—è¡¨ -->
                        </select>
                        <div style="margin-top: 4px; font-size: 11px; color: #6b6b6b;">
                            é€‰æ‹©"éšæœºé€‰æ‹©åŸŸå"å°†ä»é…ç½®çš„åŸŸååˆ—è¡¨ä¸­éšæœºé€‰æ‹©
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeRegisterModal()">å–æ¶ˆ</button>
                    <button class="btn btn-primary" onclick="startRegister()">å¼€å§‹æ³¨å†Œ</button>
                </div>
            </div>
        </div>
{% endblock %}

{% block extra_js %}
<script>
    // Define global variables for admin.js
    window.ADMIN_PATH = '{{ admin_path_segment }}';
</script>
<script src="/static/js/admin.js?v={{ static_version }}"></script>
{% endblock %}
